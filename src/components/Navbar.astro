---
const icons = {
  lecture: `<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>`,
  account: `<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>`,
  notes: `<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>`,
  quiz: `<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>`
};
---

<nav class="navbar">
  <div class="nav-content">
    <div class="nav-left">
      <a href="/lectures" class="nav-item">
        <Fragment set:html={icons.lecture} />
        <span>Lectures</span>
      </a>
      <a href="/account" class="nav-item">
        <Fragment set:html={icons.account} />
        <span>Account</span>
      </a>
    </div>

    <div class="nav-center">
      <a href="https://onlymeds.fun" class="logo" target="_blank" rel="noopener noreferrer">
        <span>M</span>
      </a>
    </div>

    <div class="nav-right">
      <a href="/Notes" class="nav-item">
        <Fragment set:html={icons.notes} />
        <span>Notes</span>
      </a>
      <a href="https://medoracle-quiz.pages.dev" class="nav-item quiz-link" target="_blank" rel="noopener noreferrer">
        <Fragment set:html={icons.quiz} />
        <span>Quiz</span>
      </a>
    </div>
  </div>
</nav>

<style>
  .navbar {
    position: fixed;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    padding: 0.75rem;
    z-index: 1000;
    width: calc(100% - 4rem);
    max-width: 400px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .nav-content {
    display: flex;
    justify-content: space-around;
    align-items: center;
    position: relative;
    padding: 0 0.5rem;
  }

  .nav-left, .nav-right {
    display: flex;
    width: 40%;
    justify-content: space-around;
  }

  .nav-item {
    color: var(--text-color);
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    opacity: 0.7;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 42px;
    height: 42px;
    justify-content: center;
    padding: 0.4rem;
  }

  .nav-item:hover,
  .nav-item:active {
    opacity: 1;
    transform: translateY(-2px);
  }

  .nav-item span {
    font-size: 0.65rem;
    font-weight: 500;
    margin-top: 0.25rem;
  }

  .nav-item .icon {
    width: 18px;
    height: 18px;
    stroke-width: 1.75;
  }

  .logo {
    background: var(--purple-primary);
    color: white;
    width: 42px;
    height: 42px;
    border-radius: 12px;
    display: grid;
    place-items: center;
    font-weight: 700;
    font-size: 1.25rem;
    text-decoration: none;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 4px 16px rgba(79, 59, 196, 0.3);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 2;
  }

  .logo:hover {
    transform: translate(-50%, -60%);
    box-shadow: 0 8px 24px rgba(79, 59, 196, 0.4);
  }

  @media (min-width: 768px) {
    .navbar {
      display: block;
      bottom: 2rem;
      max-width: 600px;
      padding: 1rem;
    }

    .nav-item {
      width: 56px;
      height: 56px;
      padding: 0.6rem;
    }

    .nav-item .icon {
      width: 24px;
      height: 24px;
    }

    .nav-item span {
      font-size: 0.75rem;
      margin-top: 0.35rem;
    }

    .logo {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      font-size: 1.5rem;
    }

    .nav-left, .nav-right {
      width: 45%;
    }
  }
  
  /* Prevent Astro client-side routing for external quiz link */
  .quiz-link {
    data-astro-reload: true;
  }
</style>

<script>
  // Platform check for navbar navigation
  const checkPlatformBeforeNavigation = () => {
    const userAgent = navigator.userAgent.toLowerCase();
    let platform = 'unknown';
    if (userAgent.includes('iphone') || userAgent.includes('ipad')) platform = 'ios';
    else if (userAgent.includes('mac')) platform = 'macos';
    else if (userAgent.includes('android')) platform = 'android';
    else if (userAgent.includes('win')) platform = 'windows';

    const storedPlatform = localStorage.getItem('telegram_platform');
    
    // Block navigation for non-iOS/macOS users
    if (platform !== 'ios' && platform !== 'macos' && storedPlatform !== 'ios' && storedPlatform !== 'macos') {
      return false;
    }
    return true;
  };

  document.addEventListener('astro:page-load', () => {
    // Block all navbar navigation for unauthorized platforms
    const navItems = document.querySelectorAll('.nav-item:not(.quiz-link)');
    navItems.forEach(item => {
      item.addEventListener('click', (e) => {
        if (!checkPlatformBeforeNavigation()) {
          e.preventDefault();
          window.location.href = '/download-standalone';
        }
      });
    });

    // Handle quiz link separately
    const quizLink = document.querySelector('.quiz-link');
    if (quizLink) {
      quizLink.addEventListener('click', (e) => {
        if (!checkPlatformBeforeNavigation()) {
          e.preventDefault();
          window.location.href = '/download-standalone';
        } else {
          e.preventDefault();
          window.open('https://medoracle-quiz.pages.dev', '_blank', 'noopener,noreferrer');
        }
      });
    }
  });
</script>
